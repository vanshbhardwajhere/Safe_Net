{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>SafeNet Dashboard</h2>
  <div>
    <span class="badge bg-{% if user.role == 'admin' %}danger{% elif user.role == 'moderator' %}warning{% else %}primary{% endif %} fs-6">
      {{ user.role|title }}
    </span>
  </div>
</div>
<div class="row g-3">
  <div class="col-md-4">
    <div class="card text-bg-light">
      <div class="card-body">
        <div class="h4">Total Content</div>
        <div class="display-6">{{ stats.total_content }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-bg-warning">
      <div class="card-body">
        <div class="h4">Flagged</div>
        <div class="display-6">{{ stats.flagged_content }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-bg-danger">
      <div class="card-body">
        <div class="h4">Banned Users</div>
        <div class="display-6">{{ stats.banned_users }}</div>
      </div>
    </div>
  </div>
</div>

<div class="mt-4">
  <!-- Basic user options -->
  <a href="{% url 'post_comment' %}" class="btn btn-success">Post a Comment</a>
  <a href="{% url 'my_comments' %}" class="btn btn-outline-secondary">My Comments</a>
  
  <!-- Moderator/Admin options -->
  {% if user.role in 'admin,moderator' %}
    <a href="{% url 'flagged_comments' %}" class="btn btn-outline-warning">
      <i class="bi bi-flag"></i> Flagged Comments ({{ stats.flagged_content }})
    </a>
    <a href="{% url 'audit_logs' %}" class="btn btn-outline-info">
      <i class="bi bi-journal-text"></i> Audit Logs
    </a>
  {% endif %}
  
  <!-- Admin-only options -->
  {% if user.role == 'admin' %}
    <a href="{% url 'manage_users' %}" class="btn btn-outline-primary">
      <i class="bi bi-people"></i> Manage Users
    </a>
    <a href="/admin/" class="btn btn-outline-danger" target="_blank">
      <i class="bi bi-gear"></i> Admin Panel
    </a>
  {% endif %}
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <h4>Quick Post</h4>
    <form method="post" action="{% url 'post_comment' %}">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
  <div class="col-md-6">
    <h4>Recent Comments</h4>
    <ul class="list-group">
      {% for c in recent_comments %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>{{ c.user.username }}</strong>: {{ c.text }}
              <div class="small text-muted">{{ c.created_at }}</div>
            </div>
            <div>
              {% if c.status == 'safe' %}
                <span class="badge bg-success">Safe</span>
              {% elif c.status == 'flagged' %}
                <span class="badge bg-warning">Flagged</span>
              {% elif c.status == 'banned' %}
                <span class="badge bg-danger">Banned</span>
              {% endif %}
              {% if c.moderation_results.first %}
                <div class="small text-muted">
                  {{ c.moderation_results.first.label|title }} 
                  ({{ c.moderation_results.first.confidence_score|floatformat:2 }})
                </div>
              {% endif %}
            </div>
          </div>
        </li>
      {% empty %}
        <li class="list-group-item">No comments yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

